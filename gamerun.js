var canvas = document.getElementById("canvas");
var effect = document.getElementById("effect");
canvas.tabIndex = 0;
canvas.focus();
var ctx = canvas.getContext("2d");
var cte = effect.getContext("2d");

var playerPic = new Image();
playerPic.src = 'images/player-white.png'

var player2Pic = new Image();
player2Pic.src = 'images/player-pink.png'

var pathTile = new Image();
pathTile.src = 'images/path.png'

var wallTile = new Image();
wallTile.src = 'images/wall.png'

var bg = new Image();
bg.src = 'images/backdrop.png'

var tile = 
[
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','$','$','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','$','$','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.','.','#','#','#','.','#','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.'],
['.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.'],
['.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.','.','.','.','#','.','.','.','.']
];

player = {x: 0, y: 0};
player2 = {x: (tile.length - 1), y: (tile.length - 1)};
offx = 0;
offy = 0;
dirx = 0;
diry = 0;
dirpx = 0;
dirpy = 0;


tempx = 0;
tempy = 0;


function drawGhost(x, y) {
	var alpha = 1;
	var s = setInterval(function(){
		if((tempx !== player.x) || (tempy !== player.y)) {
			x += (tempx - player.x)*128;
			y += (tempy - player.y)*128;
			tempx = player.x;
			tempy = player.y;
		}
		cte.clearRect((canvas.width/2 + x - 64),(canvas.height/2 + y - 64),128,128);
		cte.fillStyle = "rgba(0,0,0,"+alpha+")";
		cte.fillRect((canvas.width/2 + x - 64),(canvas.height/2 + y - 64),128,128);
		alpha-=0.025;
		if(alpha <= 0) {
			cte.clearRect((canvas.width/2 + x - 64),(canvas.height/2 + y - 64),128,128);
			clearInterval(s);
		}
	}, 10);
}

var s = setInterval(function() {
	
				
	//0, 103, 219
	ctx.fillStyle = "#0067db";
	/*
    for(r=0; r < canvas.width; r++) 
    {
        ctx.drawImage(bg, (bg.width/50)*r, 0, bg.width, 1024);
    }
	*/
	ctx.fillRect(0,0,canvas.width,canvas.height);

	for(i = 0; i < tile.length; i++)
	{
		for(j = 0; j < tile[i].length; j++)
		{
			if(tile[i][j] == '.') {
				//ctx.strokeStyle = "#000000";
				ctx.drawImage(pathTile, (((canvas.width/2) - player.x*128 + j*128)- 64), ((canvas.height/2) - player.y*128 + i*128 - 64), 128, 128);
			}
			if(tile[i][j] == '#') {
				//ctx.strokeStyle = "#0000ff";
				ctx.drawImage(wallTile, (((canvas.width/2) - player.x*128 + j*128)- 64), ((canvas.height/2) - player.y*128 + i*128 - 64), 128, 128);
			}
			if(tile[i][j] == '$') {
				ctx.fillStyle = "#8585dd";
				ctx.fillRect((((canvas.width/2) - player.x*128 + j*128)- 64), ((canvas.height/2) - player.y*128 + i*128 - 64), 128, 128);
				ctx.strokeStyle = "#ffffff";
				ctx.strokeRect((((canvas.width/2) - player.x*128 + j*128)- 64), ((canvas.height/2) - player.y*128 + i*128 - 64), 128, 128);
			}

						// Center the player 	Player size   Tile offset	32 is for center offset
			//ctx.strokeRect((((canvas.width/2) - player.x*64 + j*64)- 32), ((canvas.height/2) - player.y*64 + i*64 - 32), 64, 64);
		}
	}
	

	ctx.fillStyle = "#ffffff";

			// Center the player 	32 is for center offset
	ctx.drawImage(playerPic, ((canvas.width/2) - 64), ((canvas.height/2) - 64), 128, 128);

			// Center the player 	Player2 size   Player offset	64 is for center offset
	ctx.fillRect(((canvas.width/2) + player2.x*128 - (player.x*128) - 64), ((canvas.height/2) + player2.y*128 - (player.y*128) - 64), 128, 128);

}, 10);


//Cool game design idea: since we can't interpolate the movements of the other player, have them leave a fading trail and align them to the coordinates

function moveLeft(player) {
	if((player.x > 0) && (tile[player.y][player.x - 1] != '#'))
	{
		//drawGhost((0), (0));
		player.x--;
	}
}

function moveRight(player) {
	if((player.x < (tile.length - 1)) && (tile[player.y][player.x + 1] != '#'))
	{
		//drawGhost((0), (0));
		player.x++;
	}
}

function moveDown(player) {
	if((player.y > 0) && (tile[player.y - 1][player.x] != '#'))
	{
		//drawGhost((0), (0));
		player.y--;
	}
}

function moveUp(player) {
	if((player.y < (tile.length - 1)) && (tile[player.y + 1][player.x] != '#'))
	{
		//drawGhost((0), (0));
		player.y++;
	}
}

canvas.addEventListener("keydown", function(e){
	
	//player

	if(e.keyCode == 37) {
		moveLeft(player);
	}
	if(e.keyCode == 39) {
		moveRight(player);
	}
	if(e.keyCode == 38) {
		moveDown(player);
	}
	if(e.keyCode == 40) {
		moveUp(player);
	}
	
	
	//player 2

	if(e.keyCode == 65) {
		moveLeft(player2);
	}
	if(e.keyCode == 68) {
		moveRight(player2);
	}
	if(e.keyCode == 87) {
		moveDown(player2);
	}
	if(e.keyCode == 83) {
		moveUp(player2);
	}

});

canvas.addEventListener("keyup", function(e){
	console.log("YOU");
	if(dirx !== 0) {
		if(e.keyCode == 37) {
			dirpx = dirx;
			dirx = 0;
		}
		if(e.keyCode == 39) {
			dirpx = dirx;
			dirx = 0;
		}	
	}
	if(diry !== 0) {
		if(e.keyCode == 38) {
			dirpy = diry;
			diry = 0;
		}
		if(e.keyCode == 40) {
			dirpy = diry;
			diry = 0;
		}
	}
});

//left = 37, right = 39, up = 38, down = 40

